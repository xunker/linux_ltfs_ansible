---
# TODO: don't copy if bashx already present
- name: Copy BashX tarball
  copy:
    src: files/bashx_v3.1.2.tar.gz
    dest: "{{ansible_env.HOME}}/"

- name: Extract BashX to /root/.bashx
  ansible.builtin.command:
    argv:
      - tar
      - -zxf
      - "{{ansible_env.HOME}}/bashx_v3.1.2.tar.gz"
      - --directory
      - "{{ansible_env.HOME}}/.bashx/v3.1.2"

- name: Copy LTFS Watcher to ltfs-tape-watcher
  copy:
    src: files/ltfs-tape-watcher/
    dest: "{{ansible_env.HOME}}/ltfs-tape-watcher/"

# TODO: skip if already installed
- name: Download Crystal-Lang installer
  ansible.builtin.command:
    cmd: "wget -o install_crystal.sh https://crystal-lang.org/install.sh"
    creates: "{{ansible_env.HOME}}/install_crystal.sh"

- name: Install Crystal-Lang for building Watcher
  ansible.builtin.command:
    cmd: "{{ansible_env.HOME}}/install_crystal.sh"
    creates: /usr/bin/crystal

# TODO: add ltfs watcher to systemd and start it on boot
